angular.module("angular-meditor",[]).directive("meditor",["$timeout",function(a){"use strict";return{scope:{},transclude:!0,templateUrl:"views/editor.html",link:function(b,c){b.position={top:10,left:10,bellow:!1},b.showToolbar=!1,b.sizeOptions=[{label:"10",value:1},{label:"13",value:2},{label:"16",value:3},{label:"18",value:4},{label:"24",value:5},{label:"32",value:6},{label:"48",value:7}],b.size=b.sizeOptions[0].value,b.familyOptions=[{label:"Open Sans",value:"Open Sans, sans-serif"},{label:"Source Sans Pro",value:"Source Sans Pro, sans-serif"},{label:"Exo",value:"Exo, sans-serif"},{label:"Oswald",value:"Oswald, sans-serif"},{label:"Cardo",value:"Cardo, serif"},{label:"Vollkorn",value:"Vollkorn, serif"},{label:"Old Standard TT",value:"Old Standard TT, serif"}],b.family=b.familyOptions[0],b.styles={};var d={b:"",strong:"",i:"",em:"",u:""},e=c.find(".angular-meditor-toolbar"),f=c.find(".angular-meditor-content"),g=c.find("select"),h=angular.element("body");f.attr("contenteditable",!0);var i=function(){var a=e[0].offsetHeight,c=e[0].offsetWidth,d=5,f=window.getSelection(),g=f.getRangeAt(0),i=g.getBoundingClientRect(),j=i.top,k=i.left;return i.top<a+d?(b.position.top=j+i.height+d,b.position.bellow=!0):(b.position.top=j-a-d,b.position.bellow=!1),b.position.left=k-c/2+i.width/2,b.position.top+=h[0].scrollTop,b.position.left+=h[0].scrollLeft,this},j=function(){var d=window.getSelection(),e=d.anchorNode;if(!e)return a(function(){b.showToolbar=!1});for(var f=e.parentNode;void 0!==f.tagName&&f!==c[0];)f=f.parentNode;return f===c[0]?(a(function(){""===d.toString().trim()?b.showToolbar=!1:(b.showToolbar=!0,i())}),k(d)):a(function(){b.showToolbar=!1}),this},k=function(c){var e=c.anchorNode;e.tagName||(e=c.anchorNode.parentNode);var f=e.childNodes[0];f&&f.tagName&&f.tagName.toLowerCase()in d&&(e=e.childNodes[0]),a(function(){b.styles=window.getComputedStyle(e,null),angular.forEach(b.familyOptions,function(a,c){return-1!==b.styles.fontFamily.indexOf(a.label)?(b.family=b.familyOptions[c],!1):void 0}),angular.forEach(b.sizeOptions,function(a,c){return b.styles.fontSize===a.label+"px"?(b.size=b.sizeOptions[c].value,!1):void 0})})};f.bind("keyup",j),document.addEventListener("mouseup",j);var l;f.bind("blur",function(){l&&clearTimeout(l),l=setTimeout(j,200)});var m;g.bind("blur",function(){m&&clearTimeout(m),m=setTimeout(j,200)}),b.SimpleAction=function(a){document.execCommand("styleWithCSS",!1,!1),document.execCommand(a,!1,null)},b.$watch("size",function(){document.execCommand("styleWithCSS",!1,!0),document.execCommand("fontSize",!1,b.size)}),b.$watch("family",function(){window.WebFont&&WebFont.load({google:{families:[b.family.label]}}),document.execCommand("styleWithCSS",!1,!0),document.execCommand("fontName",!1,b.family.value)}),function(){var a=document.createElement("script");a.src=("https:"===document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",a.type="text/javascript",a.async="true";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}(),h.append(c.find(".angular-meditor-toolbar"))}}}]),angular.module("angular-meditor").run(["$templateCache",function(a){"use strict";a.put("views/editor.html",'<div class="angular-meditor">\n  <div class="angular-meditor-toolbar" style="top: {{ position.top }}px; left: {{ position.left }}px" ng-class="{ \'angular-meditor-toolbar--show\': showToolbar, \'angular-meditor-toolbar--bottom\': position.bellow }">\n    <ul>\n      <li>\n        <button type="button" ng-click="SimpleAction(\'bold\')" class="meditor-button-bold" ng-class="{ \'bold\': \'meditor-button--active\' }[styles.fontWeight]">\n          B\n        </button>\n      </li>\n      <li>\n        <button type="button" ng-click="SimpleAction(\'italic\')" class="meditor-button-italic" ng-class="{ \'italic\': \'meditor-button--active\' }[styles.fontStyle]">\n          I\n        </button>\n      </li>\n      <li>\n        <button type="button" ng-click="SimpleAction(\'underline\')" class="meditor-button-underline" ng-class="{ \'underline\': \'meditor-button--active\' }[styles.textDecoration]">\n          U\n        </button>\n      </li>\n      <li>\n        <label class="meditor-select">\n          <select ng-model="size" ng-options="s.value as s.label for s in sizeOptions" class="meditor-size-selector"></select>\n        </label>\n      </li>\n      <li>\n        <label class="meditor-select">\n          <select ng-model="family" ng-options="s as s.label for s in familyOptions" class="meditor-family-selector"></select>\n        </label>\n      </li>\n    </ul>\n  </div>\n  <div class="angular-meditor-content" ng-transclude></div>\n</div>\n')}]);